{% extends "testit/base.html" %}

{% block content %}

<div style="border: 2px solid #9bc6d7; margin: 10px; padding: 10px; display: flex; flex-direction: column; gap: 16px; border-radius: 6px; border-style: outset;">
    <form method="get" action="/testit/question-bank/search">
        <input type="text" name="search" placeholder="Search..." value="{{ request.GET.search }}" style="width: 50%; padding: 5px; font-size: 16px; border-color: rgb(137, 3, 10); border-radius: 6px;">
    </form>
</div>

<div style="display: flex; gap: 20px;">

    <!-- available questions table -->
    <div class="table-container" style="margin: 10px;">
        <div class="table-header">Available Questions</div>
        <table border="1" class="styled-table">
            <thead>
                <tr>
                    <th>Question</th>
                    <th></th>
                    <th>Status</th>
                    <th>Solver count</th>
                </tr>
            </thead>
            <tbody>
                {% for question, status, solver_count, tags in context %}
                <tr>
                    <td>
                        <a href="{% url 'testit:question_detail' question.id %}">
                            {{ question.title }}
                        </a>
                    </td>
                    <td style="position: relative; width: 400px;">
                        <div style="position: absolute; bottom: 4px; right: 10px; font-size: 12px; color: #cccccc50;">
                            {% for tag in tags %}
                                <span style="margin-left: 4px;">{{ tag.title }}</span>
                            {% endfor %}
                        </div>
                    </td>

                    {% if status %}
                        <td style="color: seagreen; width: 80x;">Solved</td>
                    {% else %}
                        <td style="color: rgb(137, 3, 10); width: 80px;">Unsolved</td>
                    {% endif %}

                    <td style="width: 100px; text-align: center;">{{ solver_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- combined filters form -->
    <div style="min-width: 200px;">
        <form method="get" action="" style="border: 2px solid #9bc6d7; margin: 10px; padding: 10px; display: flex; flex-direction: column; gap: 16px; border-radius: 6px; border-style: outset;">
            
            <!-- tag filter -->
            <div s>
                <h3>Filter by Tags</h3>
                <select name="tags" multiple size="6" style="width: 100%; border-radius: 6px; border-color: rgb(137, 3, 10);">
                    {% for tag in tags %}
                        <option value="{{ tag.id }}"
                            {% if tag.id|stringformat:"s" in selected_tag_ids %}
                                selected
                            {% endif %}>
                            {{ tag.title }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- solver range filter -->
            <div>
                <h3>Solver Count Range</h3>
                <label for="min_solvers">Min:</label>
                <input type="number" name="min_solvers" id="min_solvers" value="{{ request.GET.min_solvers }}" style="width: 100%; border-radius: 6px; border-color: rgb(137, 3, 10);">
                <br>
                <label for="max_solvers">Max:</label>
                <input type="number" name="max_solvers" id="max_solvers" value="{{ request.GET.max_solvers }}" style="width: 100%; border-radius: 6px; border-color: rgb(137, 3, 10);">
            </div>

            <button type="submit" style="background-color: #9bc6d7; color: black; border-radius: 6px; border-color: rgb(137, 3, 10);">Apply</button>
        </form>
    </div>
</div>
{% endblock %}
